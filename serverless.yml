# Welcome to Serverless!
#
# This file is the main config file for your service.
# It's very minimal at this point and uses default values.
# You can always add more config options for more control.
# We've included some commented out config examples here.
# Just uncomment any of them to get that config option.
#
# For full config options, check the docs:
#    v1.docs.serverless.com
#
# Happy Coding!

service: guve-slack-library

provider:
  name: aws
  runtime: nodejs4.3
  region: eu-west-1
  cfLogs: true
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - dynamodb:Scan
        - dynamodb:CreateTable
        - dynamodb:PutItem
        - dynamodb:UpdateTable
        - dynamodb:DescribeTable
      Resource: "*"
  stage: ${opt:stage, self:custom.defaultStage}
  profile: ${self:custom.profiles.${self:provider.stage}}
custom:
  defaultStage: dev
  profiles:
    dev: wd-sandbox
    prod: prodProfile

# you can add packaging information here
package:
  individually: true
  exclude:
    - "**"

plugins:
  - serverless-offline

functions:
  api-library:
    handler: api/books/index.route
    events:
      - http:
          path: api/v2/book/{id}
          method: get
      - http:
          path: api/v2/books/
          method: get
      - http:
          path: api/v2/books/{query}
          method: get
      - http:
          path: api/v2/books/add
          method: post
    package:
      include:
        - node_modules/vogels/**
        - node_modules/vogels-promisified/**
        - node_modules/bluebird/**
        - node_modules/async/**
        - node_modules/bunyan/**
        - node_modules/dtrace-provider/**
        - node_modules/nan/**
        - node_modules/mv/**
        - node_modules/ncp/**
        - node_modules/rimraf/**
        - node_modules/glob/**
        - node_modules/inflight/**
        - node_modules/wrappy/**
        - node_modules/inherits/**
        - node_modules/once/**
        - node_modules/afe-json-stringify/**
        - node_modules/joi/**
        - node_modules/hoek/**
        - node_modules/isemail/**
        - node_modules/moment/**
        - node_modules/topo/**
        - node_modules/lodash/**
        - node_modules/node-uuid/**
        - node_modules/buffer/**
        - node_modules/base64-js/**
        - node_modules/ieee754/**
        - node_modules/isarray/**
        - node_modules/crypto-browserify/**
        - node_modules/jmespath/**
        - node_modules/querystring/**
        - node_modules/ax/**
        - node_modules/url/**
        - node_modules/punycode/**
        - node_modules/uuid/**
        - node_modules/xml2js/**
        - node_modules/xmlbuilder/**
        - node_modules/sax/**
        - api/books/**

resources:
  Resources:
    EBookBucket:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: wunderdog-ebooks
